<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Recargas - PayPay Ganha</title>
</head>
<body>
    <div class="card">
        <h3>Trocar Pontos</h3>
        <table style="width:100%; text-align: left; border-collapse: collapse;">
            <tr style="border-bottom: 1px solid #333;">
                <th style="padding:10px;">Valor</th>
                <th>Pontos</th>
                <th>Ação</th>
            </tr>
            <tr>
                <td style="padding:10px;">100 Kz</td>
                <td>500</td>
                <td><button onclick="resgatar(500, 'Unitel')" class="btn-primary" style="padding:5px;">Unitel</button></td>
            </tr>
            <tr>
                <td style="padding:10px;">200 Kz</td>
                <td>900</td>
                <td><button onclick="resgatar(900, 'Africel')" class="btn-primary" style="padding:5px;">Africel</button></td>
            </tr>
            <tr>
                <td style="padding:10px;">500 Kz</td>
                <td>2000</td>
                <td><button onclick="resgatar(2000, 'Unitel')" class="btn-primary" style="padding:5px;">Unitel</button></td>
            </tr>
        </table>
    </div>

    <script type="module">
        import { auth, db } from "./firebase.js";
        import { doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        window.resgatar = async (custo, operadora) => {
            const userRef = doc(db, "users", auth.currentUser.uid);
            const snap = await getDoc(userRef);
            const pontosAtuais = snap.data().pontos;

            if(pontosAtuais >= custo) {
                await updateDoc(userRef, {
                    pontos: increment(-custo)
                });
                alert(`Sucesso! Recarga ${operadora} solicitada.`);
            } else {
                alert("❌ Pontos insuficientes!");
            }
        };
    </script>
</body>
</html>
